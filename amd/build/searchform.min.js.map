{"version":3,"file":"searchform.min.js","sources":["../src/searchform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchform\n *\n * @module     local_lessonbank/searchform\n * @copyright  2025 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Log from 'core/log';\nimport loading from 'core/loadingicon';\n\nconst component = 'local_lessonbank';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#local_lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const searchFilter = form => {\n        const args = {\n            language: '',\n            level: '',\n            keywords: ''\n        };\n        if (form.elements.language) {\n            args.language = form.elements.language.value;\n        }\n        if (form.elements.search) {\n            args.keywords = form.elements.search.value;\n        }\n        if (form.elements.level && form.elements.level.offsetParent) {\n            args.level = form.elements.level.value;\n        }\n\n        Ajax.call([{\n            methodname: `${component}_list_minilessons`,\n            args\n        }])[0]\n        .then(items => {\n            Log.debug(items);\n            Templates.render(`${component}/lessonbankitems`, {items})\n            .then((html, js) => {\n                Templates.replaceNodeContents(cardsContainer, html, js);\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        searchFilter(form);\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (!downloadbtn.dataset.id) {\n            return;\n        }\n        const promise = loading.addIconToContainerWithPromise(downloadbtn);\n        Ajax.call([{\n            methodname: `${component}_fetch_minilesson`,\n            args: {\n                id: Number(downloadbtn.dataset.id)\n            }\n        }])[0]\n        .then(data => {\n            promise.resolve();\n            const blob = new Blob([data.json], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            e.target.href = url;\n            e.target.download = `${e.target.dataset.download}.json`;\n            e.target.click();\n            e.target.removeAttribute('href');\n            URL.revokeObjectURL(url);\n        }).catch(e => {\n            promise.reject();\n            Notification.exception(e);\n        });\n    });\n    if (form) {\n        searchFilter(form);\n        if (form.elements.submit) {\n            form.elements.submit.parentElement.classList.add('d-none');\n            form.elements.submit.classList.add('rounded-right');\n            form.elements.search.insertAdjacentElement('afterend', form.elements.submit);\n            form.elements.search.parentElement.classList.add('input-group');\n        }\n    }\n};"],"names":["form","document","querySelector","cardsContainer","searchFilter","args","language","level","keywords","elements","value","search","offsetParent","call","methodname","then","items","debug","render","html","js","replaceNodeContents","catch","Notification","exception","addEventListener","e","preventDefault","target","href","downloadbtn","closest","dataset","id","promise","loading","addIconToContainerWithPromise","Number","data","resolve","blob","Blob","json","type","url","URL","createObjectURL","download","click","removeAttribute","revokeObjectURL","reject","submit","parentElement","classList","add","insertAdjacentElement"],"mappings":";;;;;;;k8BA8B8B,WACpBA,KAAOC,SAASC,cAAc,6BAC9BC,eAAiBF,SAASC,cAAc,mCACxCE,aAAeJ,aACXK,KAAO,CACTC,SAAU,GACVC,MAAO,GACPC,SAAU,IAEVR,KAAKS,SAASH,WACdD,KAAKC,SAAWN,KAAKS,SAASH,SAASI,OAEvCV,KAAKS,SAASE,SACdN,KAAKG,SAAWR,KAAKS,SAASE,OAAOD,OAErCV,KAAKS,SAASF,OAASP,KAAKS,SAASF,MAAMK,eAC3CP,KAAKE,MAAQP,KAAKS,SAASF,MAAMG,qBAGhCG,KAAK,CAAC,CACPC,qBAtBM,wCAuBNT,KAAAA,QACA,GACHU,MAAKC,qBACEC,MAAMD,0BACAE,iBA3BJ,uCA2B2C,CAACF,MAAAA,QACjDD,MAAK,CAACI,KAAMC,yBACCC,oBAAoBlB,eAAgBgB,KAAMC,OAEjD,QAEVE,MAAMC,aAAaC,YAExBxB,MAAAA,MAAAA,KAAMyB,iBAAiB,UAAUC,IAC7BA,EAAEC,iBACFvB,aAAaJ,SAEjBG,eAAesB,iBAAiB,SAASC,OACjCA,EAAEE,OAAOC,YAGbH,EAAEC,uBACIG,YAAcJ,EAAEE,OAAOG,QAAQ,gCAChCD,YAAYE,QAAQC,gBAGnBC,QAAUC,qBAAQC,8BAA8BN,2BACjDjB,KAAK,CAAC,CACPC,qBAlDM,wCAmDNT,KAAM,CACF4B,GAAII,OAAOP,YAAYE,QAAQC,QAEnC,GACHlB,MAAKuB,OACFJ,QAAQK,gBACFC,KAAO,IAAIC,KAAK,CAACH,KAAKI,MAAO,CAAEC,KAAM,qBACrCC,IAAMC,IAAIC,gBAAgBN,MAChCd,EAAEE,OAAOC,KAAOe,IAChBlB,EAAEE,OAAOmB,mBAAcrB,EAAEE,OAAOI,QAAQe,kBACxCrB,EAAEE,OAAOoB,QACTtB,EAAEE,OAAOqB,gBAAgB,QACzBJ,IAAIK,gBAAgBN,QACrBtB,OAAMI,IACLQ,QAAQiB,SACR5B,aAAaC,UAAUE,SAG3B1B,OACAI,aAAaJ,MACTA,KAAKS,SAAS2C,SACdpD,KAAKS,SAAS2C,OAAOC,cAAcC,UAAUC,IAAI,UACjDvD,KAAKS,SAAS2C,OAAOE,UAAUC,IAAI,iBACnCvD,KAAKS,SAASE,OAAO6C,sBAAsB,WAAYxD,KAAKS,SAAS2C,QACrEpD,KAAKS,SAASE,OAAO0C,cAAcC,UAAUC,IAAI"}