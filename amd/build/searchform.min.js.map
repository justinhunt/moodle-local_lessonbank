{"version":3,"file":"searchform.min.js","sources":["../src/searchform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module searchform\n *\n * @module     local_lessonbank/searchform\n * @copyright  2025 Justin Hunt (poodllsupport@gmail.com)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\nimport * as Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport Log from 'core/log';\nimport loading from 'core/loadingicon';\n\nconst component = 'local_lessonbank';\n\nexport const registerFilter = () => {\n    const form = document.querySelector('#local_lessonbank_filters');\n    const cardsContainer = document.querySelector('[data-region=\"cards-container\"]');\n    const searchFilter = form => {\n        const args = {\n            language: '',\n            level: [],\n            keywords: ''\n        };\n        if (form.elements.language) {\n            args.language = form.elements.language.value;\n        }\n        if (form.elements.search) {\n            args.keywords = form.elements.search.value;\n        }\n        if (form.elements['level[]']) {\n            const selectedOptions = form.elements['level[]'].selectedOptions;\n            args.level = Array.from(selectedOptions).map(option => option.value);\n        }\n\n        Ajax.call([{\n            methodname: `${component}_list_minilessons`,\n            args\n        }], true, false)[0]\n        .then(items => {\n            Log.debug(items);\n            Templates.render(`${component}/lessonbankitems`, {items})\n            .then((html, js) => {\n                Templates.replaceNodeContents(cardsContainer, html, js);\n            });\n            return null;\n        })\n        .catch(Notification.exception);\n    };\n    form?.addEventListener('submit', e => {\n        e.preventDefault();\n        searchFilter(form);\n    });\n    cardsContainer.addEventListener('click', e => {\n        if (e.target.href) {\n            return;\n        }\n        e.preventDefault();\n        const downloadbtn = e.target.closest('[data-action=\"download\"]');\n        if (downloadbtn) {\n            if (!downloadbtn.dataset.id) {\n                return;\n            }\n            const promise = loading.addIconToContainerWithPromise(downloadbtn);\n            Ajax.call([{\n                methodname: `${component}_fetch_minilesson`,\n                args: {\n                    id: Number(downloadbtn.dataset.id)\n                }\n            }], true, false)[0]\n            .then(data => {\n                promise.resolve();\n                const blob = new Blob([data.json], { type: 'application/json' });\n                const url = URL.createObjectURL(blob);\n                e.target.href = url;\n                e.target.download = `${e.target.dataset.download}.json`;\n                e.target.click();\n                e.target.removeAttribute('href');\n                URL.revokeObjectURL(url);\n            }).catch(e => {\n                promise.reject();\n                Notification.exception(e);\n            });\n        }\n        const showtextbtn = e.target.closest('[data-action=\"showtext\"]');\n        if (showtextbtn) {\n            const wrapper = showtextbtn.parentElement;\n            const titlehtml = wrapper.firstElementChild.cloneNode(true).outerHTML;\n            wrapper.innerHTML = titlehtml + wrapper.dataset.text;\n        }\n    });\n    if (form) {\n        searchFilter(form);\n        if (form.elements.submit) {\n            form.elements.submit.parentElement.classList.add('d-none');\n            form.elements.submit.classList.add('rounded-right');\n            form.elements.search.insertAdjacentElement('afterend', form.elements.submit);\n            form.elements.search.parentElement.classList.add('input-group');\n        }\n    }\n};"],"names":["form","document","querySelector","cardsContainer","searchFilter","args","language","level","keywords","elements","value","search","selectedOptions","Array","from","map","option","call","methodname","then","items","debug","render","html","js","replaceNodeContents","catch","Notification","exception","addEventListener","e","preventDefault","target","href","downloadbtn","closest","dataset","id","promise","loading","addIconToContainerWithPromise","Number","data","resolve","blob","Blob","json","type","url","URL","createObjectURL","download","click","removeAttribute","revokeObjectURL","reject","showtextbtn","wrapper","parentElement","titlehtml","firstElementChild","cloneNode","outerHTML","innerHTML","text","submit","classList","add","insertAdjacentElement"],"mappings":";;;;;;;k8BA8B8B,WACpBA,KAAOC,SAASC,cAAc,6BAC9BC,eAAiBF,SAASC,cAAc,mCACxCE,aAAeJ,aACXK,KAAO,CACTC,SAAU,GACVC,MAAO,GACPC,SAAU,OAEVR,KAAKS,SAASH,WACdD,KAAKC,SAAWN,KAAKS,SAASH,SAASI,OAEvCV,KAAKS,SAASE,SACdN,KAAKG,SAAWR,KAAKS,SAASE,OAAOD,OAErCV,KAAKS,SAAS,WAAY,OACpBG,gBAAkBZ,KAAKS,SAAS,WAAWG,gBACjDP,KAAKE,MAAQM,MAAMC,KAAKF,iBAAiBG,KAAIC,QAAUA,OAAON,sBAG7DO,KAAK,CAAC,CACPC,qBAvBM,wCAwBNb,KAAAA,QACA,GAAM,GAAO,GAChBc,MAAKC,qBACEC,MAAMD,0BACAE,iBA5BJ,uCA4B2C,CAACF,MAAAA,QACjDD,MAAK,CAACI,KAAMC,yBACCC,oBAAoBtB,eAAgBoB,KAAMC,OAEjD,QAEVE,MAAMC,aAAaC,YAExB5B,MAAAA,MAAAA,KAAM6B,iBAAiB,UAAUC,IAC7BA,EAAEC,iBACF3B,aAAaJ,SAEjBG,eAAe0B,iBAAiB,SAASC,OACjCA,EAAEE,OAAOC,YAGbH,EAAEC,uBACIG,YAAcJ,EAAEE,OAAOG,QAAQ,+BACjCD,YAAa,KACRA,YAAYE,QAAQC,gBAGnBC,QAAUC,qBAAQC,8BAA8BN,2BACjDjB,KAAK,CAAC,CACPC,qBApDE,wCAqDFb,KAAM,CACFgC,GAAII,OAAOP,YAAYE,QAAQC,QAEnC,GAAM,GAAO,GAChBlB,MAAKuB,OACFJ,QAAQK,gBACFC,KAAO,IAAIC,KAAK,CAACH,KAAKI,MAAO,CAAEC,KAAM,qBACrCC,IAAMC,IAAIC,gBAAgBN,MAChCd,EAAEE,OAAOC,KAAOe,IAChBlB,EAAEE,OAAOmB,mBAAcrB,EAAEE,OAAOI,QAAQe,kBACxCrB,EAAEE,OAAOoB,QACTtB,EAAEE,OAAOqB,gBAAgB,QACzBJ,IAAIK,gBAAgBN,QACrBtB,OAAMI,IACLQ,QAAQiB,SACR5B,aAAaC,UAAUE,YAGzB0B,YAAc1B,EAAEE,OAAOG,QAAQ,+BACjCqB,YAAa,OACPC,QAAUD,YAAYE,cACtBC,UAAYF,QAAQG,kBAAkBC,WAAU,GAAMC,UAC5DL,QAAQM,UAAYJ,UAAYF,QAAQrB,QAAQ4B,SAGpDhE,OACAI,aAAaJ,MACTA,KAAKS,SAASwD,SACdjE,KAAKS,SAASwD,OAAOP,cAAcQ,UAAUC,IAAI,UACjDnE,KAAKS,SAASwD,OAAOC,UAAUC,IAAI,iBACnCnE,KAAKS,SAASE,OAAOyD,sBAAsB,WAAYpE,KAAKS,SAASwD,QACrEjE,KAAKS,SAASE,OAAO+C,cAAcQ,UAAUC,IAAI"}